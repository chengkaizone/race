package race.cheng.view;

import static race.cheng.service.Constant.CHOOSE;
import static race.cheng.service.Constant.ENTER_ABOUT_VIEW;
import static race.cheng.service.Constant.ENTER_HELP_VIEW;
import static race.cheng.service.Constant.ENTER_SET_VIEW;
import race.cheng.main.R;
import race.cheng.main.RaceActivity;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.graphics.Canvas;
import android.graphics.Paint;
import android.view.MotionEvent;
import android.view.SurfaceHolder;
import android.view.SurfaceView;

/**
 * 游戏主菜单界面
 * 
 * @author chengkai
 * 
 */
public class ViewMainMenu extends SurfaceView implements SurfaceHolder.Callback {
	RaceActivity activity;// 声明引用
	Bitmap mainMenu;// 声明引用
	Paint paint;// 创建画笔
	float screenWidth = 480;
	float x_Offset = RaceActivity.screenWidth / 2 - screenWidth / 2;

	public ViewMainMenu(RaceActivity activity) {
		super(activity);
		this.activity = activity;
		this.getHolder().addCallback(this); // 设置生命周期接口
		paint = new Paint(); // 创建画笔
		paint.setAntiAlias(true); // 打开抗锯齿
		mainMenu = BitmapFactory.decodeResource(this.getResources(),
				R.drawable.mainmenu);// 加载菜单图片
	}

	// 触摸事件回调方法
	@Override
	public boolean onTouchEvent(MotionEvent e) {
		float x = e.getX();// 获取X坐标
		float y = e.getY();// 获取Y坐标

		switch (e.getAction()) {
		case MotionEvent.ACTION_DOWN:

			if (x > 5 + x_Offset && x < 92 + x_Offset && y > 285 && y < 314)// 点击设置按钮
			{
				activity.toAnotherView(ENTER_SET_VIEW);// 进入设置界面
			}
			if (x > 100 + x_Offset && x < 187 + x_Offset && y > 285 && y < 314)// 点击帮助按钮
			{
				activity.toAnotherView(ENTER_HELP_VIEW);// 进入帮助界面
			}
			if (x > 196 + x_Offset && x < 283 + x_Offset && y > 285 && y < 314)// 点击开始游戏按钮
			{
				activity.toAnotherView(CHOOSE);// 进入游戏选择界面
			}
			if (x > 292 + x_Offset && x < 380 + x_Offset && y > 285 && y < 314)// 点击关于按钮
			{
				activity.toAnotherView(ENTER_ABOUT_VIEW);// 进入关于界面
			}
			if (x > 387 + x_Offset && x < 474 + x_Offset && y > 285 && y < 314)// 点击退出按钮
			{
				System.exit(0);// 退出
			}
			break;
		}
		return true;
	}

	@Override
	public void onDraw(Canvas canvas) {
		super.onDraw(canvas);
		canvas.drawBitmap(mainMenu, RaceActivity.screenWidth / 2 - screenWidth
				/ 2, 0, paint);
	}

	@Override
	public void surfaceChanged(SurfaceHolder holder, int format, int width,
			int height) {
	}

	@Override
	public void surfaceCreated(SurfaceHolder holder) {
		Canvas canvas = holder.lockCanvas();// 获取画布
		try {
			synchronized (holder) {
				onDraw(canvas);// 绘制
			}
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			if (canvas != null) {
				holder.unlockCanvasAndPost(canvas);
			}
		}
	}

	@Override
	public void surfaceDestroyed(SurfaceHolder holder) {
	}
}
